Bootstrap: docker
From: docker.io/mambaorg/micromamba:1.5.8

%post
    # Install Lace and dependencies
    micromamba install -y -n base -c conda-forge -c bioconda \
        lace=1.14.1 \
        && micromamba clean --all --yes

    # Patch Lace source: replace deprecated .node[ with .nodes[
    # NetworkX 2.8+ and 3.x removed the .node attribute entirely
    sed -i 's/\.node\[/\.nodes\[/g' \
        /opt/conda/lib/python3.*/site-packages/Lace/BuildSuperTranscript.py

%environment
    export PATH="/opt/conda/bin:${PATH}"

%labels
    Author martpali
    Version 1.14.1_patched
    Description Lace 1.14.1 patched for NetworkX 3.x compatibility

%help
    Custom Lace container with patched BuildSuperTranscript.py.

    The upstream Lace 1.14.1 uses the deprecated NetworkX .node attribute
    which was removed in NetworkX 3.x. This container patches all
    occurrences of .node[ to .nodes[ so SuperTranscript construction works.

    Usage:
        apptainer exec lace_1.14.1_patched.sif Lace input.fasta clusters.txt -o output/
